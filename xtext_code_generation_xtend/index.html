<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Code Generation (with Xtend) - self-dsl</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Code Generation (with Xtend)";
    var mkdocs_page_input_path = "xtext_code_generation_xtend.md";
    var mkdocs_page_url = "/xtext_code_generation_xtend/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> self-dsl</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Welcome to self-dsl</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../motivation/">Motivation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../basics/">Basics of meta modeling for domain models</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Xtext</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../xtext_eclipse/">Eclipse</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_project_setup/">Xtext Project Setup</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_a_first_grammar/">A First Grammar</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_auto_formatting/">Auto Formatting</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_model_validation/">Model Validation</a>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_quickfixes/">Quickfixes</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Code Generation (with Xtend)</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#code-generation-with-xtend">Code Generation (with Xtend)</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#simple-example">Simple Example</a></li>
        
            <li><a class="toctree-l4" href="#xtend-template-engine">Xtend template engine</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../xtext_xtend/">Xtend: Selected Aspects</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">TextX</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../textx_project_setup/">TextX Project Setup</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../references/">References</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">self-dsl</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Xtext &raquo;</li>
        
      
    
    <li>Code Generation (with Xtend)</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="code-generation-with-xtend">Code Generation (with Xtend)</h1>
<p>Xtend is highly optimized to be used
for code generation. It has a optimzed template engine (e.g., with
automatic indentation support) and
is fully integrated in the Eclipse IDE (auto completition
for model data).</p>
<h2 id="simple-example">Simple Example</h2>
<p>Open the *Generator.xtend file in your project, e.g.,
kurs.xtext.dataflow.generator.DataFlowDslGenerator.xtend. 
Here, you can implement your first code generator:
You have model access (parameter "resource") and file system access
(parameter "fsa").</p>
<div class="codehilite"><pre><span></span><span class="n">override</span> <span class="kt">void</span> <span class="nf">doGenerate</span><span class="o">(</span><span class="n">Resource</span> <span class="n">resource</span><span class="o">,</span> <span class="n">IFileSystemAccess2</span> <span class="n">fsa</span><span class="o">,</span> 
        <span class="n">IGeneratorContext</span> <span class="n">context</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// -------------------------------------------</span>
    <span class="c1">// Option 1:</span>
    <span class="n">var</span> <span class="n">txt</span> <span class="o">=</span> <span class="s">&quot;&quot;</span>
    <span class="k">for</span> <span class="o">(</span><span class="nl">obj:</span> <span class="n">resource</span><span class="o">.</span><span class="n">allContents</span><span class="o">.</span><span class="n">toIterable</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">obj</span> <span class="k">instanceof</span> <span class="n">KComponent</span><span class="o">)</span> <span class="o">{</span> <span class="c1">// inside this &quot;if&quot; obj is a KComponent</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">txt</span><span class="o">.</span><span class="n">length</span><span class="o">&gt;</span><span class="mi">0</span><span class="o">)</span> <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span> <span class="o">+</span> <span class="s">&quot;, &quot;</span>
            <span class="n">txt</span> <span class="o">=</span> <span class="n">txt</span> <span class="o">+</span> <span class="n">obj</span><span class="o">.</span><span class="n">name</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">fsa</span><span class="o">.</span><span class="n">generateFile</span><span class="o">(</span><span class="s">&#39;Components1.txt&#39;</span><span class="o">,</span> <span class="s">&#39;Component declarations: &#39;</span> <span class="o">+</span> <span class="n">txt</span><span class="o">);</span>

    <span class="c1">// -------------------------------------------</span>
    <span class="c1">// Option 2:</span>
    <span class="n">fsa</span><span class="o">.</span><span class="n">generateFile</span><span class="o">(</span><span class="s">&#39;Components2.txt&#39;</span><span class="o">,</span> <span class="s">&#39;Component declarations: &#39;</span> <span class="o">+</span> 
        <span class="n">resource</span><span class="o">.</span><span class="n">allContents</span>
            <span class="o">.</span><span class="n">filter</span><span class="o">[</span> <span class="n">obj</span> <span class="o">|</span> <span class="n">obj</span> <span class="k">instanceof</span> <span class="n">KComponent</span><span class="o">]</span>
            <span class="o">.</span><span class="n">map</span><span class="o">[</span> <span class="n">obj</span> <span class="o">|</span> <span class="k">return</span> <span class="o">(</span><span class="n">obj</span> <span class="n">as</span> <span class="n">KComponent</span><span class="o">).</span><span class="n">name</span> <span class="o">]</span>
            <span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="s">&#39;, &#39;</span><span class="o">))</span>

    <span class="c1">// -------------------------------------------</span>
    <span class="c1">// Option 3:</span>
    <span class="n">fsa</span><span class="o">.</span><span class="n">generateFile</span><span class="o">(</span><span class="s">&#39;Components3.txt&#39;</span><span class="o">,</span> <span class="s">&#39;Component declarations: &#39;</span> <span class="o">+</span> 
        <span class="n">resource</span><span class="o">.</span><span class="n">allContents</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="n">KComponent</span><span class="o">).</span><span class="n">map</span><span class="o">[</span><span class="n">name</span><span class="o">].</span><span class="n">join</span><span class="o">(</span><span class="s">&#39;, &#39;</span><span class="o">))</span>
<span class="o">}</span>
</pre></div>


<p>In the last example we generate a text describing a list of components on 
three different manners.</p>
<ol>
<li>A traditional for-each loop<ul>
<li>Note: "auto-casting" happens; this mean if a type of an inctance is 
  checked (if „instanceof“), 
  the object is automatically casted to that type within the 
  body of the if.</li>
<li>Semicolons are optional.</li>
<li>"var" und "val" are used to declare variable (val: final variables).</li>
</ul>
</li>
<li>A filter/map/join combination with explicit lambda („[ param | code ]“)<ul>
<li>The lambda function is directly defined with square brackets '['...']'.</li>
<li>The brackets '('...')' of the function call are omitted.</li>
<li>The parameter of the lambda function are stated before the "|"
  within the '['..']'.</li>
</ul>
</li>
<li>A filter/map/join combination with compact lambdas and class filters: <ul>
<li>filter(Class) filters according to the passed class "Class".</li>
<li>map: here, the parameter is implizit defined (and can be addressed 
  with the name "it": e.g., it.name). 
  Moreover, the implicit name of the parameter can be omitted,
  thus, "name" corresponds to "it.name" here: 
  "[a | a.name]" → "[name]" oder "[it.name]"</li>
<li>"return" can be omitted: The last expression is the return value.</li>
</ul>
</li>
</ol>
<p>The generated files contain the text:</p>
<div class="codehilite"><pre><span></span><span class="err">Component declarations: PC, DF</span>
</pre></div>


<h2 id="xtend-template-engine">Xtend template engine</h2>
<p>Xtext and Xtend provide a powerful template engine. With this engine
output text and code can be easily mixed. Moreover, indentations
in this mixed code are separated between output indentation and logical
template code indentation (see example: the indentation from the nested
FOR statement are ignored in the output).</p>
<div class="codehilite"><pre><span></span>    :::xtend
    // -------------------------------------------
    // Option 4:
    val model = resource.contents.get(0) as Model
    fsa.generateFile(&#39;Components4.txt&#39;, &#39;&#39;&#39;
    The Components of the model are:
    «FOR p: model.packages»
        Package «p.name»
        «FOR c: p.components»
            KComponent «c.name»
            «FOR port: c.ports SEPARATOR &quot;, &quot;» 
            - with port «port.name»
            «ENDFOR»
        «ENDFOR»
    «ENDFOR»
    &#39;&#39;&#39;);
</pre></div>


<p>Such templates are defined with a multi line string bounded by
three single qutation marks.
Within the template special commands (like FOR-loops) can be 
expressed with text bounded by french quotes.
The editor supports many features, such as automatic completition of model
data and displaying the actual indentation. </p>
<p>Note:
  * This example als illustrates how to get the
    root of the model (val model=...).
  * It also shows how to cast an object: „obj as Type“.</p>
<p>Output (generated artefact; note the indentation in the template is omitted):</p>
<div class="codehilite"><pre><span></span><span class="err">The Components of the model are:</span>
<span class="err">Package test1</span>
<span class="err">KComponent PC</span>
<span class="err">- with port in, </span>
<span class="err">- with port out</span>
<span class="err">KComponent DF</span>
<span class="err">- with port in, </span>
<span class="err">- with port out, </span>
<span class="err">- with port debug</span>
</pre></div>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../xtext_xtend/" class="btn btn-neutral float-right" title="Xtend: Selected Aspects">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../xtext_quickfixes/" class="btn btn-neutral" title="Quickfixes"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../xtext_quickfixes/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../xtext_xtend/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
